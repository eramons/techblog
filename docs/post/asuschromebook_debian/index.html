<!DOCTYPE html>
<html itemscope itemtype="http://schema.org/WebPage" lang="en">

<head>
    <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">






    <meta name="description" content="The Asus Chromebook Flip C101PA (bob) is a convertible touchscreen laptop powered by an ARMv8 Rockchip RK3399 hexa-core processor and 4GB RAM, measuring 10.4&quot; x 7.2&quot; x 0.6&quot; and weighing 1 kg.
Features:
 Rockchip RK3399 (OP1) dual-core 2.0GHz Cortex-A72 and quad-core 1.4GHz Cortex-A53 processor 4GB LPDDR3 RAM 10.1&quot; 1280x800 LED display Mali T860MP4 GPU 16GB eMMC 38 Whrs battery 2x USB 3.1 Type-C ports 1x USB 2.0 Type-A port  ARM Chromebooks ship with the Coreboot bootloader and use Depthcharge as the payload.">



    
    
        
    

    


    <title>Debian on Asus Chromebook Flip C101PA | Small Technical Blog</title>

    <link rel="apple-touch-icon" sizes="180x180" href="/techblog/favicon/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/techblog/favicon/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/techblog/favicon/favicon-16x16.png">

    

    <meta property="og:title" content="Debian on Asus Chromebook Flip C101PA" />
<meta property="og:description" content="The Asus Chromebook Flip C101PA (bob) is a convertible touchscreen laptop powered by an ARMv8 Rockchip RK3399 hexa-core processor and 4GB RAM, measuring 10.4&quot; x 7.2&quot; x 0.6&quot; and weighing 1 kg.
Features:
 Rockchip RK3399 (OP1) dual-core 2.0GHz Cortex-A72 and quad-core 1.4GHz Cortex-A53 processor 4GB LPDDR3 RAM 10.1&quot; 1280x800 LED display Mali T860MP4 GPU 16GB eMMC 38 Whrs battery 2x USB 3.1 Type-C ports 1x USB 2.0 Type-A port  ARM Chromebooks ship with the Coreboot bootloader and use Depthcharge as the payload." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://eramons.github.io/techblog/post/asuschromebook_debian/" />
<meta property="article:published_time" content="2018-12-04T10:00:00+02:00" />
<meta property="article:modified_time" content="2018-12-04T10:00:00+02:00" />

<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Debian on Asus Chromebook Flip C101PA"/>
<meta name="twitter:description" content="The Asus Chromebook Flip C101PA (bob) is a convertible touchscreen laptop powered by an ARMv8 Rockchip RK3399 hexa-core processor and 4GB RAM, measuring 10.4&quot; x 7.2&quot; x 0.6&quot; and weighing 1 kg.
Features:
 Rockchip RK3399 (OP1) dual-core 2.0GHz Cortex-A72 and quad-core 1.4GHz Cortex-A53 processor 4GB LPDDR3 RAM 10.1&quot; 1280x800 LED display Mali T860MP4 GPU 16GB eMMC 38 Whrs battery 2x USB 3.1 Type-C ports 1x USB 2.0 Type-A port  ARM Chromebooks ship with the Coreboot bootloader and use Depthcharge as the payload."/>


    <link rel="preload" as="font" href="/techblog/fonts/Metropolis.woff2" type="font/woff2" crossorigin="anonymous">
<link rel="preload" as="font" href="/techblog/fonts/LiberationSans.woff2" type="font/woff2" crossorigin="anonymous">
<link rel="preload" as="font" href="/techblog/fonts/LiberationSans-Bold.woff2" type="font/woff2" crossorigin="anonymous">
<link rel="preload" as="font" href="/techblog/fonts/LiberationSans-BoldItalic.woff2" type="font/woff2" crossorigin="anonymous">
<link rel="preload" as="font" href="/techblog/fonts/LiberationSans-Italic.woff2" type="font/woff2" crossorigin="anonymous">
<link rel="preload" as="font" href="/techblog/fonts/LiberationMono.woff2" type="font/woff2" crossorigin="anonymous">
<link rel="preload" as="font" href="/techblog/fonts/DroidSans.woff2" type="font/woff2" crossorigin="anonymous">
<link rel="preload" as="font" href="/techblog/fonts/GeekblogIcons.woff2" type="font/woff2" crossorigin="anonymous">

<link rel="preload" href="/techblog/main-85732d8853.min.css" as="style">
<link rel="stylesheet" href="/techblog/main-85732d8853.min.css" media="all">

<link rel="preload" href="/techblog/mobile-14fbbb71d2.min.css" as="style">
<link rel="stylesheet" href="/techblog/mobile-14fbbb71d2.min.css" media="screen and (max-width: 45rem)">

<link rel="preload" href="/techblog/print-86167e859a.min.css" as="style">
<link rel="stylesheet" href="/techblog/print-86167e859a.min.css" media="print">

<link rel="preload" href="/techblog/custom.css" as="style">
<link rel="stylesheet" href="/techblog/custom.css" media="all">



<!-- Made with Geekblog theme https://github.com/thegeeklab/hugo-geekblog -->

    




<script type="application/ld+json">
{
    "@context": "http://schema.org",
    "@type": "BlogPosting",
    "articleSection": "post",
    "name": "Debian on Asus Chromebook Flip C101PA",
    "headline": "Debian on Asus Chromebook Flip C101PA",
    "alternativeHeadline": "",
    "description": "The Asus Chromebook Flip C101PA (bob) is a convertible touchscreen laptop powered by an ARMv8 Rockchip RK3399 hexa-core processor and 4GB RAM, measuring 10.4\u0026quot; x 7.2\u0026quot; x 0.6\u0026quot; and weighing 1 kg.\nFeatures:\n Rockchip RK3399 (OP1) dual-core 2.0GHz Cortex-A72 and quad-core 1.4GHz Cortex-A53 processor 4GB LPDDR3 RAM 10.1\u0026quot; 1280x800 LED display Mali T860MP4 GPU 16GB eMMC 38 Whrs battery 2x USB 3.1 Type-C ports 1x USB 2.0 Type-A port  ARM Chromebooks ship with the Coreboot bootloader and use Depthcharge as the payload.",
    "inLanguage": "en",
    "isFamilyFriendly": "true",
    "mainEntityOfPage": {
        "@type": "WebPage",
        "@id": "https:\/\/eramons.github.io\/techblog\/post\/asuschromebook_debian\/"
    },
    "author" : [
    ],
    "copyrightHolder" : "Small Technical Blog",
    "copyrightYear" : "2018",
    "dateCreated": "2018-12-04T10:00:00.00Z",
    "datePublished": "2018-12-04T10:00:00.00Z",
    "dateModified": "2018-12-04T10:00:00.00Z",
    "publisher":{
        "@type":"Organization",
        "name": "Small Technical Blog",
        "url": "https://eramons.github.io/techblog/",
        "logo": {
            "@type": "ImageObject",
            "url": "https:\/\/eramons.github.io\/techblog\/eve.png",
            "width":"32",
            "height":"32"
        }
    },
    "url" : "https:\/\/eramons.github.io\/techblog\/post\/asuschromebook_debian\/",
    "wordCount" : "2545",
    "genre" : [ "debian" , "arm" ]
}
</script>


</head>

<body>
    <svg style="position: absolute; width: 0; height: 0; overflow: hidden;" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><symbol viewBox="-7.27 -7.27 46.55 46.55" id="arrow_back" xmlns="http://www.w3.org/2000/svg"><path d="M31.999 14.035v3.93H7.673l11.134 11.228L16 32 .001 16.001 16 .002l2.807 2.807L7.673 14.037h24.326z"/></symbol><symbol viewBox="-7.27 -7.27 46.55 46.55" id="arrow_left" xmlns="http://www.w3.org/2000/svg"><path d="M7.954 17.965v5.988L.001 16l7.953-7.953v5.988H32v3.93H7.954z"/></symbol><symbol viewBox="-7.27 -7.27 46.55 46.55" id="arrow_right" xmlns="http://www.w3.org/2000/svg"><path d="M24.046 14.035V8.047L31.999 16l-7.953 7.953v-5.988H0v-3.93h24.046z"/></symbol><symbol viewBox="-7.27 -7.27 42.55 42.55" id="bitbucket" xmlns="http://www.w3.org/2000/svg"><path d="M15.905 13.355c.189 1.444-1.564 2.578-2.784 1.839-1.375-.602-1.375-2.784-.034-3.403 1.151-.705 2.818.223 2.818 1.564zm1.907-.361c-.309-2.44-3.076-4.056-5.328-3.042-1.426.636-2.389 2.148-2.32 3.747.086 2.097 2.08 3.815 4.176 3.626s3.729-2.234 3.472-4.331zm4.108-9.315c-.756-.997-2.045-1.169-3.179-1.358-3.214-.516-6.513-.533-9.727.034-1.066.172-2.269.361-2.939 1.323 1.1 1.031 2.664 1.186 4.073 1.358 2.544.327 5.156.344 7.699.017 1.426-.172 3.008-.309 4.073-1.375zm.979 17.788c-.481 1.684-.206 3.953-1.994 4.932-3.076 1.701-6.806 1.89-10.191 1.289-1.787-.327-3.884-.894-4.864-2.578-.43-1.65-.705-3.334-.98-5.018l.103-.275.309-.155c5.121 3.386 12.288 3.386 17.427 0 .808.241.206 1.22.189 1.805zM26.01 4.951c-.584 3.764-1.255 7.51-1.908 11.257-.189 1.1-1.255 1.719-2.148 2.183-3.214 1.615-6.96 1.89-10.483 1.512-2.389-.258-4.829-.894-6.771-2.389-.911-.705-.911-1.908-1.083-2.922-.602-3.523-1.289-7.046-1.719-10.604.206-1.547 1.942-2.217 3.231-2.698C6.848.654 8.686.362 10.508.19c3.884-.378 7.854-.241 11.618.859 1.341.395 2.784.945 3.695 2.097.412.533.275 1.203.189 1.805z"/></symbol><symbol viewBox="-7.27 -7.27 46.55 46.55" id="bookmarks" xmlns="http://www.w3.org/2000/svg"><path d="M20.357 5.856q1.157 0 2.043.851t.885 2.008v23.284l-10.212-4.357-10.144 4.357V8.715q0-1.157.885-2.008t2.042-.851h14.502zm5.787 18.859V5.856q0-1.157-.851-2.042t-2.008-.885H8.715q0-1.157.885-2.042t2.043-.885h14.502q1.157 0 2.043.885t.885 2.042v23.216z"/></symbol><symbol viewBox="-7.27 -7.27 46.55 46.55" id="clear" xmlns="http://www.w3.org/2000/svg"><path d="M32 3.222L19.222 16 32 28.778l-3.221 3.221-12.778-12.778L3.223 31.999.002 28.778 12.78 16 .002 3.222 3.223.001l12.778 12.778L28.779.001z"/></symbol><symbol viewBox="-7.27 -7.27 42.55 42.55" id="code" xmlns="http://www.w3.org/2000/svg"><path d="M9.917 24.5a1.75 1.75 0 10-3.501.001 1.75 1.75 0 003.501-.001zm0-21a1.75 1.75 0 10-3.501.001A1.75 1.75 0 009.917 3.5zm11.666 2.333a1.75 1.75 0 10-3.501.001 1.75 1.75 0 003.501-.001zm1.75 0a3.502 3.502 0 01-1.75 3.026c-.055 6.581-4.721 8.039-7.82 9.023-2.898.911-3.846 1.349-3.846 3.117v.474a3.502 3.502 0 011.75 3.026c0 1.932-1.568 3.5-3.5 3.5s-3.5-1.568-3.5-3.5c0-1.294.711-2.424 1.75-3.026V6.526A3.502 3.502 0 014.667 3.5c0-1.932 1.568-3.5 3.5-3.5s3.5 1.568 3.5 3.5a3.502 3.502 0 01-1.75 3.026v9.06c.93-.456 1.914-.766 2.807-1.039 3.391-1.075 5.323-1.878 5.359-5.687a3.502 3.502 0 01-1.75-3.026c0-1.932 1.568-3.5 3.5-3.5s3.5 1.568 3.5 3.5z"/></symbol><symbol viewBox="-7.27 -7.27 46.55 46.55" id="contacts" xmlns="http://www.w3.org/2000/svg"><path d="M22.688 22.688v-2q0-1.5-2.281-2.438t-4.406-.938-4.406.938-2.281 2.438v2h13.375zM16 9q-1.25 0-2.125.875T13 12t.875 2.125T16 15t2.125-.875T19 12t-.875-2.125T16 9zm10.688-3.687q1.063 0 1.844.813t.781 1.875v16q0 1.063-.781 1.875t-1.844.813H5.313q-1.063 0-1.844-.813t-.781-1.875v-16q0-1.063.781-1.875t1.844-.813h21.375zM5.313 32v-2.688h21.375V32H5.313zM26.688 0v2.688H5.313V0h21.375z"/></symbol><symbol viewBox="-7.27 -7.27 46.55 46.55" id="create" xmlns="http://www.w3.org/2000/svg"><path d="M31.499 7.167l-3.25 3.25-6.666-6.666 3.25-3.25q.5-.5 1.25-.5t1.25.5l4.166 4.166q.5.5.5 1.25t-.5 1.25zM.001 25.333L19.667 5.667l6.666 6.666L6.667 31.999H.001v-6.666z"/></symbol><symbol viewBox="-7.27 -7.27 46.55 46.55" id="date" xmlns="http://www.w3.org/2000/svg"><path d="M27.192 28.844V11.192H4.808v17.652h22.384zm0-25.689q1.277 0 2.253.976t.976 2.253v22.459q0 1.277-.976 2.216t-2.253.939H4.808q-1.352 0-2.291-.901t-.939-2.253V6.385q0-1.277.939-2.253t2.291-.976h1.577V.001h3.23v3.155h12.769V.001h3.23v3.155h1.577zm-3.155 11.267v3.155h-3.23v-3.155h3.23zm-6.46 0v3.155h-3.155v-3.155h3.155zm-6.384 0v3.155h-3.23v-3.155h3.23z"/></symbol><symbol viewBox="-7.27 -7.27 46.55 46.55" id="download" xmlns="http://www.w3.org/2000/svg"><path d="M2.866 28.209h26.269v3.79H2.866v-3.79zm26.268-16.925L16 24.418 2.866 11.284h7.493V.001h11.283v11.283h7.493z"/></symbol><symbol viewBox="-7.27 -7.27 46.55 46.55" id="email" xmlns="http://www.w3.org/2000/svg"><path d="M28.845 9.615v-3.23L16 14.422 3.155 6.385v3.23L16 17.577zm0-6.46q1.277 0 2.216.977T32 6.385v19.23q0 1.277-.939 2.253t-2.216.977H3.155q-1.277 0-2.216-.977T0 25.615V6.385q0-1.277.939-2.253t2.216-.977h25.69z"/></symbol><symbol viewBox="-7.27 -7.27 42.55 42.55" id="git" xmlns="http://www.w3.org/2000/svg"><path d="M27.472 12.753L15.247.529a1.803 1.803 0 00-2.55 0l-2.84 2.84 2.137 2.137a2.625 2.625 0 013.501 3.501l3.499 3.499a2.625 2.625 0 11-1.237 1.237l-3.499-3.499c-.083.04-.169.075-.257.106v7.3a2.626 2.626 0 11-1.75 0v-7.3a2.626 2.626 0 01-1.494-3.607L8.62 4.606l-8.09 8.09a1.805 1.805 0 000 2.551l12.225 12.224a1.803 1.803 0 002.55 0l12.168-12.168a1.805 1.805 0 000-2.551z"/></symbol><symbol viewBox="-7.27 -7.27 46.55 46.55" id="github" xmlns="http://www.w3.org/2000/svg"><path d="M16 .394c8.833 0 15.999 7.166 15.999 15.999 0 7.062-4.583 13.062-10.937 15.187-.813.146-1.104-.354-1.104-.771 0-.521.021-2.25.021-4.396 0-1.5-.5-2.458-1.083-2.958 3.562-.396 7.312-1.75 7.312-7.896 0-1.75-.625-3.167-1.646-4.291.167-.417.708-2.042-.167-4.25-1.333-.417-4.396 1.646-4.396 1.646a15.032 15.032 0 00-8 0S8.937 6.602 7.603 7.018c-.875 2.208-.333 3.833-.167 4.25-1.021 1.125-1.646 2.542-1.646 4.291 0 6.125 3.729 7.5 7.291 7.896-.458.417-.875 1.125-1.021 2.146-.917.417-3.25 1.125-4.646-1.333-.875-1.521-2.458-1.646-2.458-1.646-1.562-.021-.104.979-.104.979 1.042.479 1.771 2.333 1.771 2.333.938 2.854 5.396 1.896 5.396 1.896 0 1.333.021 2.583.021 2.979 0 .417-.292.917-1.104.771C4.582 29.455-.001 23.455-.001 16.393-.001 7.56 7.165.394 15.998.394zM6.063 23.372c.042-.083-.021-.187-.146-.25-.125-.042-.229-.021-.271.042-.042.083.021.187.146.25.104.062.229.042.271-.042zm.646.709c.083-.062.062-.208-.042-.333-.104-.104-.25-.146-.333-.062-.083.062-.062.208.042.333.104.104.25.146.333.062zm.625.937c.104-.083.104-.25 0-.396-.083-.146-.25-.208-.354-.125-.104.062-.104.229 0 .375s.271.208.354.146zm.875.875c.083-.083.042-.271-.083-.396-.146-.146-.333-.167-.417-.062-.104.083-.062.271.083.396.146.146.333.167.417.062zm1.187.521c.042-.125-.083-.271-.271-.333-.167-.042-.354.021-.396.146s.083.271.271.312c.167.062.354 0 .396-.125zm1.313.104c0-.146-.167-.25-.354-.229-.187 0-.333.104-.333.229 0 .146.146.25.354.229.187 0 .333-.104.333-.229zm1.208-.208c-.021-.125-.187-.208-.375-.187-.187.042-.312.167-.292.312.021.125.187.208.375.167s.312-.167.292-.292z"/></symbol><symbol viewBox="-7.27 -7.27 42.55 42.55" id="gitlab" xmlns="http://www.w3.org/2000/svg"><path d="M1.629 11.034L14 26.888.442 17.048a1.09 1.09 0 01-.39-1.203l1.578-4.811zm7.217 0h10.309l-5.154 15.854zM5.753 1.475l3.093 9.559H1.63l3.093-9.559a.548.548 0 011.031 0zm20.618 9.559l1.578 4.811c.141.437-.016.922-.39 1.203l-13.558 9.84 12.371-15.854zm0 0h-7.216l3.093-9.559a.548.548 0 011.031 0z"/></symbol><symbol viewBox="-7.27 -7.27 46.55 46.55" id="heart" xmlns="http://www.w3.org/2000/svg"><path d="M16 29.714a1.11 1.11 0 01-.786-.321L4.072 18.643c-.143-.125-4.071-3.714-4.071-8 0-5.232 3.196-8.357 8.535-8.357 3.125 0 6.053 2.464 7.464 3.857 1.411-1.393 4.339-3.857 7.464-3.857 5.339 0 8.535 3.125 8.535 8.357 0 4.286-3.928 7.875-4.089 8.035L16.785 29.392c-.214.214-.5.321-.786.321z"/></symbol><symbol viewBox="-7.27 -7.27 46.55 46.55" id="keyborad_arrow_left" xmlns="http://www.w3.org/2000/svg"><path d="M25.875 28.25L22.125 32 6.126 16.001 22.125.002l3.75 3.75-12.25 12.25z"/></symbol><symbol viewBox="-7.27 -7.27 46.55 46.55" id="keyborad_arrow_right" xmlns="http://www.w3.org/2000/svg"><path d="M6.125 28.25L18.375 16 6.125 3.75 9.875 0l15.999 15.999L9.875 31.998z"/></symbol><symbol viewBox="-7.27 -7.27 46.55 46.55" id="link" xmlns="http://www.w3.org/2000/svg"><path d="M24.037 7.963q3.305 0 5.634 2.366T32 16t-2.329 5.671-5.634 2.366h-6.46v-3.08h6.46q2.028 0 3.493-1.465t1.465-3.493-1.465-3.493-3.493-1.465h-6.46v-3.08h6.46zM9.615 17.578v-3.155h12.77v3.155H9.615zM3.005 16q0 2.028 1.465 3.493t3.493 1.465h6.46v3.08h-6.46q-3.305 0-5.634-2.366T0 16.001t2.329-5.671 5.634-2.366h6.46v3.08h-6.46q-2.028 0-3.493 1.465t-1.465 3.493z"/></symbol><symbol viewBox="-7.27 -7.27 46.55 46.55" id="menu" xmlns="http://www.w3.org/2000/svg"><path d="M.001 5.334h31.998v3.583H.001V5.334zm0 12.416v-3.5h31.998v3.5H.001zm0 8.916v-3.583h31.998v3.583H.001z"/></symbol><symbol viewBox="-7.27 -7.27 46.55 46.55" id="notifications" xmlns="http://www.w3.org/2000/svg"><path d="M25.846 22.154l3.308 3.308v1.615H2.847v-1.615l3.308-3.308V14q0-3.846 1.961-6.692t5.423-3.692V2.462q0-1 .692-1.731T16 0t1.769.731.692 1.731v1.154q3.461.846 5.423 3.692T25.846 14v8.154zM16 32q-1.385 0-2.346-.923t-.962-2.308h6.615q0 1.308-1 2.269T15.999 32z"/></symbol><symbol viewBox="-7.27 -7.27 46.55 46.55" id="person" xmlns="http://www.w3.org/2000/svg"><path d="M16 20.023q5.052 0 10.526 2.199t5.473 5.754v4.023H0v-4.023q0-3.555 5.473-5.754t10.526-2.199zM16 16q-3.275 0-5.614-2.339T8.047 8.047t2.339-5.661T16 0t5.614 2.386 2.339 5.661-2.339 5.614T16 16z"/></symbol><symbol viewBox="-7.27 -7.27 46.55 46.55" id="pin" xmlns="http://www.w3.org/2000/svg"><path d="M17.6 19.2h9.6v-1.6L22.4 16V3.2l4.8-1.6V0H4.8v1.6l4.8 1.6V16l-4.8 1.6v1.6h9.6v11.2L16 32l1.6-1.6V19.2z"/></symbol><symbol viewBox="-7.27 -7.27 46.55 46.55" id="rss_feed" xmlns="http://www.w3.org/2000/svg"><path d="M-.481 12.048q8.482 0 14.457 5.976t5.976 14.457h-5.879q0-5.976-4.289-10.264T-.48 17.928v-5.879zm0-11.565q13.204 0 22.601 9.397t9.397 22.601h-5.783q0-10.891-7.662-18.553T-.481 6.266V.483zm0 27.468q0-1.831 1.301-3.132t3.229-1.301 3.181 1.253 1.253 3.181-1.301 3.229-3.132 1.301q-1.928 0-3.229-1.301T-.48 27.952z"/></symbol><symbol viewBox="-7.27 -7.27 46.55 46.55" id="search" xmlns="http://www.w3.org/2000/svg"><path d="M11.925 20.161q3.432 0 5.834-2.402t2.402-5.834-2.402-5.834-5.834-2.402-5.834 2.402-2.402 5.834 2.402 5.834 5.834 2.402zm10.981 0L32 29.255 29.255 32l-9.094-9.094v-1.458l-.515-.515q-3.26 2.831-7.721 2.831-4.976 0-8.45-3.432T.001 11.925t3.474-8.45 8.45-3.474 8.407 3.474 3.432 8.45q0 1.802-.858 4.075t-1.973 3.646l.515.515h1.458z"/></symbol><symbol viewBox="-7.27 -7.27 46.55 46.55" id="security" xmlns="http://www.w3.org/2000/svg"><path d="M16 0l13.072 5.855v8.715q0 6.059-3.745 11.063T16 31.999q-5.583-1.362-9.327-6.366T2.928 14.57V5.855zm0 16v13.004q4.017-1.294 6.808-4.868T26.144 16H16zm0 0V3.2L5.856 7.693v8.306H16z"/></symbol><symbol viewBox="-7.27 -7.27 46.55 46.55" id="telescope" xmlns="http://www.w3.org/2000/svg"><path d="M25.026 3.335a.466.466 0 00-.646-.238L13.362 8.91a.463.463 0 00-.216.575l.227.593-6.36 3.488a.462.462 0 00-.205.583l.211.508-6.755 3.228a.463.463 0 00-.228.595l1.386 3.341a.463.463 0 00.583.259l7.056-2.5.211.508a.462.462 0 00.557.267l6.733-1.941.202.527a.46.46 0 00.566.277l12.03-3.702a.46.46 0 00.293-.613L25.026 3.335zM2.109 21.061l-1.049-2.53 6.314-3.018 1.332 3.211-6.596 2.337zm7.857-1.708l-.22-.531-1.706-4.113-.22-.53 5.863-3.216 2.197 5.676.347.908-6.261 1.806zm7.505-1.146l-.188-.491c-.003-.01-.001-.022-.006-.032l-.572-1.478-2.549-6.668 10.201-5.381 4.249 10.624-11.136 3.428zm8.943-16.723a.463.463 0 00-.86.344l5.552 13.881a.464.464 0 00.602.258.464.464 0 00.258-.602L26.413 1.484zM16.268 20.627h-2.776c-1.055 0-1.851.796-1.851 1.851v1.217l-5.44 6.347a.462.462 0 10.702.602l5.415-6.316h2.101v6.015a.463.463 0 00.926 0v-6.015h2.101l5.414 6.316a.462.462 0 10.703-.602l-5.44-6.347v-1.148c0-1.076-.813-1.92-1.851-1.92zm.925 2.777h-4.627v-.925c0-.545.38-.925.925-.925h2.776c.527 0 .925.428.925.995v.856z"/></symbol><symbol viewBox="-7.27 -7.27 46.55 46.55" id="timer" xmlns="http://www.w3.org/2000/svg"><path d="M16 29q4.428 0 7.536-3.143t3.107-7.571-3.107-7.536T16 7.643 8.464 10.75t-3.107 7.536 3.107 7.571T16 29zM26.714 9.786q1.214 1.571 2.107 4.036t.893 4.464q0 5.643-4 9.678T16 32t-9.714-4.036-4-9.678 4-9.678T16 4.572q1.929 0 4.464.929t4.107 2.143l2.143-2.214q1.143.929 2.143 2.143zM14.5 19.857v-9.143h3v9.143h-3zM20.571.001v3.071h-9.143V.001h9.143z"/></symbol><symbol viewBox="-7.27 -7.27 46.55 46.55" id="tree" xmlns="http://www.w3.org/2000/svg"><path d="M32 14.423H20.808V9.616h-3.23v12.77h3.23v-4.807H32v12.845H20.808v-4.807h-6.385v-16h-3.23v4.807H.001V1.579h11.192v4.807h9.615V1.579H32v12.845z"/></symbol></svg>

    <div class="wrapper">
        <header class="gblog-header">
    <div class="container flex align-center justify-center">
        <a class="gblog-header__link" rel="me" href="https://eramons.github.io/techblog/">
            <span class="gblog-brand flex align-center justify-center">
                <img class="gblog-brand__img" src="/techblog/eve.png" alt="" width=60 height=60>
                Small Technical Blog
            </span>
            
            <span class="gblog-brand__subtitle flex align-center justify-center">E. Ramon</span>
            
        </a>
    </div>
</header>
<nav class="gblog-nav">
    <input type="checkbox" id="menu-control" class="hidden">
    <div class="gblog-nav__control">
        <label for="menu-control"  class="flex align-center justify-center">
            <svg class="icon menu"><use xlink:href="#menu"></use></svg>
            <svg class="icon clear"><use xlink:href="#clear"></use></svg>
            <span>Nav</span>
        </label>
    </div>
    <ul class="gblog-nav__list container flex flex-wrap justify-center menu-content">
        
        
        
        
        
        <li>
            <a class="gblog-nav__entry " href="/techblog/tags/android/">android</a>
        </li>
        
        
        
        <li>
            <a class="gblog-nav__entry " href="/techblog/tags/arm/">arm</a>
        </li>
        
        
        
        <li>
            <a class="gblog-nav__entry " href="/techblog/tags/coreboot/">coreboot</a>
        </li>
        
        
        
        <li>
            <a class="gblog-nav__entry " href="/techblog/tags/cozy/">cozy</a>
        </li>
        
        
        
        <li>
            <a class="gblog-nav__entry " href="/techblog/tags/debian/">debian</a>
        </li>
        
        
        
        <li>
            <a class="gblog-nav__entry " href="/techblog/tags/kubernetes/">kubernetes</a>
        </li>
        
        
        
        <li>
            <a class="gblog-nav__entry " href="/techblog/tags/networking/">networking</a>
        </li>
        
        
        
        <li>
            <a class="gblog-nav__entry " href="/techblog/tags/nextcloud/">nextcloud</a>
        </li>
        
        
        
        <li>
            <a class="gblog-nav__entry " href="/techblog/tags/u-boot/">u-boot</a>
        </li>
        
        
    </ul>
</nav>


        <main class="gblog-page container">
            
    <article class="gblog-post">
        <header class="gblog-post__header">
            
            

            <h1>Debian on Asus Chromebook Flip C101PA</h1>
            
            <div class="gblog-post__meta">
                <span class="no-wrap">
                    <svg class="icon date"><use xlink:href="#date"></use></svg>
                    <span class="gblog-post__tag">
                        <time datetime="2018-12-04T10:00:00&#43;02:00">
                            
                            Dec 4, 2018
                        </time>
                    </span>
                </span>

                <span class="no-wrap">
                    <svg class="icon timer"><use xlink:href="#timer"></use></svg>
                    <span class="gblog-post__tag">12 min read</span>
                </span>
            </div>
            
        </header>

        <section class="gblog-markdown">
            



    


<p><em>The Asus Chromebook Flip C101PA (bob) is a convertible touchscreen laptop powered by an ARMv8 Rockchip RK3399 hexa-core processor and 4GB RAM, measuring 10.4&quot; x 7.2&quot; x 0.6&quot; and weighing 1 kg.</em></p>
<p>Features:</p>
<ul>
<li>Rockchip RK3399 (OP1) dual-core 2.0GHz Cortex-A72 and quad-core 1.4GHz Cortex-A53 processor</li>
<li>4GB LPDDR3 RAM</li>
<li>10.1&quot; 1280x800 LED display</li>
<li>Mali T860MP4 GPU</li>
<li>16GB eMMC</li>
<li>38 Whrs battery</li>
<li>2x USB 3.1 Type-C ports</li>
<li>1x USB 2.0 Type-A port</li>
</ul>
<p>ARM Chromebooks ship with the Coreboot bootloader and use Depthcharge as the payload. Further reading:</p>
<p><a href="https://www.coreboot.org">Coreboot Website</a></p>
<p><a href="https://github.com/coreboot/depthcharge">Depthcharge Source Code</a></p>
<p>The kernel is signed and packed in a custom format and must be flashed to a dedicated partition on the sdcard or to the internal ssd. Further reading:</p>
<p><a href="https://www.chromium.org/chromium-os/chromiumos-design-docs/disk-format">Chromium: Disk Format</a></p>
<p>After enabling Developer Mode and USB Boot, it&rsquo;s possible to boot either ChromeOS from the internal disk of the chromebook (Ctrl-D) or from USB (Ctrl-U).</p>
<p><strong>Goal: run Debian on the ChromeOS</strong></p>
<p><strong>Motivation:</strong> the Asus C101PA is a light (and cheap) laptop - perfect to carry it everywhere. Using ChromeOS only was not an option for me, so I aimed to run Debian Linux on it.</p>
<p><strong>Milestones:</strong></p>
<ol>
<li>Dual boot ChromeOS and Linux: run archlinux on a sdcard</li>
<li>Replace the archlinux filesystem with a Debian rootfs</li>
<li>Replace the kernel (ChromeOS) with the mainline Linux kernel</li>
<li>Troubleshooting: modify kernel options and install firmware</li>
<li>Flash the working kernel to the chromebook internal memory</li>
<li>Replace the kernel (Linux) with the latest Debian kernel</li>
</ol>
<p>Files and scripts available in github:</p>
<p><a href="https://github.com/eramons/chromebook">https://github.com/eramons/chromebook</a></p>
<div class="gblog-post__anchorwrap"><h2 id="1-archlinux">1. Archlinux<a data-clipboard-text="https://eramons.github.io/techblog/post/asuschromebook_debian/#1-archlinux" class="gblog-post__anchor gblog-post__anchor--right clip" aria-label="Anchor 1. Archlinux" href="#1-archlinux"><svg class="icon link"><use xlink:href="#link"></use></svg></a></h2></div>
<p><strong>Goal: try out a working linux distribution on the Chromebook</strong></p>
<p><em>On the chromebook</em></p>
<p>I started taking a look at the excelent Arch Linux wiki:
<a href="https://archlinuxarm.org/platforms/armv8/rockchip/asus-chromebook-flip-c101pa">ArchLinuxArm</a></p>
<p>This links provides instructions for the installation of Arch Linux from a sdcard in dual boot setup. I closely followed the instructions in order to:</p>
<ul>
<li>Enable Developer Mode</li>
<li>Enable booting from USB</li>
<li>Partition the sdcard</li>
<li>Download the tarball. The Arch Linux tarball includes the ChromeOS kernel and an Arch Linux filesystem.</li>
<li>Copy the file system to the second partition on the card</li>
<li>Flash the kernel into the first partition on the card</li>
</ul>
<div class="gblog-post__anchorwrap"><h2 id="2-debian-root-file-system">2. Debian Root File System<a data-clipboard-text="https://eramons.github.io/techblog/post/asuschromebook_debian/#2-debian-root-file-system" class="gblog-post__anchor gblog-post__anchor--right clip" aria-label="Anchor 2. Debian Root File System" href="#2-debian-root-file-system"><svg class="icon link"><use xlink:href="#link"></use></svg></a></h2></div>
<p><strong>Goal: running Debian system on the sdcard booting the ChromeOS kernel provided by archlinux and a debian filesystem.</strong></p>
<p>For the preparation of the debian rootfs, I inserted the sdcard in my laptop and mounted the partition which would host the rootfs. I used then debootstrap to install the base system.</p>
<p><em>On the laptop</em></p>
<p>Mount the second sdcard partition:</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">mkdir rootfs
sudo mount /dev/sdb2 rootfs
</code></pre></div><p>Use debootstrap in order to create a Debian sid root file system:</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">sudo debootstrap --arch<span class="o">=</span>arm64 --verbose --foreign sid rootfs
</code></pre></div><p>Changeroot to the new created filesystem:</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">sudo chroot
</code></pre></div><p>Create a user and set the user&rsquo;s and the root passwords:</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">passwd
adduser eramon
passwd eramon
</code></pre></div><p>Install following packages:</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">apt-get install wicd-curses openssh-server sudo git xserver-xorg gnome
</code></pre></div><p>Exit the chroot, umount the filesystem and sync:</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash"><span class="nb">exit</span>
umount rootfs
sync
</code></pre></div><p><em>Back on the chromebook</em></p>
<p>Insert the sdcard on the chromebook and press CTRL-U as soon as the boot screen appears.</p>
<p>The firmware files and the modules will be missing on the system. Get them from the archlinux tarball:</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">sudo cp -r rootfs/lib/firmware /lib/
sudo cp -r rootfs/lib/modules/* /lib/modules/
</code></pre></div><p>The module files in archlinux seem to be compressed: they have the extension .ko.gz. In order for them to work with the debian filesystem, I had to unzip them first.</p>
<div class="gblog-post__anchorwrap"><h2 id="3-mainline-linux-kernel">3. Mainline Linux Kernel<a data-clipboard-text="https://eramons.github.io/techblog/post/asuschromebook_debian/#3-mainline-linux-kernel" class="gblog-post__anchor gblog-post__anchor--right clip" aria-label="Anchor 3. Mainline Linux Kernel" href="#3-mainline-linux-kernel"><svg class="icon link"><use xlink:href="#link"></use></svg></a></h2></div>
<p><strong>Goal: replace the ChromeOS kernel through the mainline linux kernel.</strong></p>
<p>As a reference, I read the instructions for building a package on the archlinux PKGBUILD file for linux-gru in order to figure out which steps needed to be done:
<a href="https://github.com/archlinuxarm/PKGBUILDs/blob/master/core/linux-gru/PKGBUILD">archlinuxarm/PKGBUILDS</a></p>
<p>In order to avoid cross compiling issues and to keep things simple, I aimed to do all the compiling and even the flashing directly on the chromebook. At this stage I had already a working environment consisting on the chromeos kernel and the new debian filesystem.</p>
<p>First get the mainline kernel source code:</p>
<pre><code>git clone git://git.kernel.org/pub/scm/linux/kernel/git/torvalds/linux.git linux-git
</code></pre><p>Get into the source directory and generate a default configuration:</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash"><span class="nb">cd</span> linux-git
make defconfig
</code></pre></div><p>Compile the kernel:</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">make Image Dtbs Modules
</code></pre></div><p>Download the kernel.its file used by arch linux to build their package:
<a href="https://github.com/archlinuxarm/PKGBUILDs/blob/master/core/linux-gru/kernel.its">kernel.its</a></p>
<p>There are several configurations in this file, we only need the first one. We also need to modify the path and name of the dtbs file.</p>
<p>I modified the file as follows:</p>
<p><a href="https://github.com/eramons/chromebook/mainlinekernel.its">https://github.com/eramons/chromebook/mainlinekernel.its</a></p>
<pre><code>/dts-v1/;

/ {
    description = &quot;Linux mainline kernel image with one blob&quot;;
    images {
        kernel@1{
            description = &quot;kernel&quot;;
            data = /incbin/(&quot;linux-git/arch/arm64/boot/Image&quot;);
            type = &quot;kernel_noload&quot;;
            arch = &quot;arm64&quot;;
            os = &quot;linux&quot;;
            compression = &quot;none&quot;;
            load = &lt;0&gt;;
            entry = &lt;0&gt;;
        };
        fdt@1{
            description = &quot;rk3399-gru-bob.dtb&quot;;
            data = /incbin/(&quot;linux-git/arch/arm64/boot/dts/rockchip/rk3399-gru-bob.dtb&quot;);
            type = &quot;flat_dt&quot;;
            arch = &quot;arm64&quot;;
            compression = &quot;none&quot;;
            hash@1{
                algo = &quot;sha1&quot;;
            };
        };
    };
    configurations {
        default = &quot;conf@1&quot;;
        conf@1{
            kernel = &quot;kernel@1&quot;;
            fdt = &quot;fdt@1&quot;;
        };
    };
};
</code></pre><p>Make image:</p>
<pre><code>mkimage -D &quot;-I dts -O dtb -p 2048&quot; -f mainlinekernel.its vmlinux.uimg
</code></pre><p>Prepare the cmdline:</p>
<pre><code>echo &quot;console=ttyS2,115200n8 earlyprintk=ttyS2,115200n8 console=tty1 init=/sbin/init root=PARTUUID=%U/PARTNROFF=1 rootwait rw noinitrd loglevel=4&quot; &gt; cmdline_mainline
</code></pre><p>Generate an empty bootloader.bin file:</p>
<pre><code>dd if=/dev/zero of=bootloader.bin bs=512 count=1
</code></pre><p>Run vbutil in order to generate a boot image for the chromebook:</p>
<pre><code>vbutil_kernel
        --pack vmlinux.kpart
        --version 1
        --vmlinuz vmlinux.uimg
        --arch aarch64
        --keyblock /usr/share/vboot/devkeys/kernel.keyblock
        --signprivate /usr/share/vboot/devkeys/kernel_data_key.vbprivk
        --config cmdline_mainline
        --bootloader bootloader.bin
</code></pre><p>Flash the new generated image to the first partition of the sdcard, sync and reboot:</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">sudo dd <span class="k">if</span><span class="o">=</span>vmlinuz.kpart <span class="nv">of</span><span class="o">=</span>/dev/mmcblk1p1
sudo sync
sudo reboot
</code></pre></div><p>My script automating the aforementioned steps (mkimage, cmdline, vbutil) is available here:</p>
<p><a href="https://github.com/eramons/chromebook/blob/master/run.sh">https://github.com/eramons/chromebook/blob/master/run.sh</a></p>
<p>In case the screen remains blank when trying to boot the new kernel it helps to do serial port debugging with the help of a SuzyQable:
<a href="https://www.chromium.org/chromium-os/ccd#TOC-SuzyQ-SuzyQable">SuzyQable</a></p>
<ul>
<li>Use the USB-C port close to the screen, since the other one does not offer a serial port connection.</li>
<li>Make sure the cable is plugged in the right position (the letters DBG have to be upside).</li>
<li>Use minicom to connect via serial port and follow the boot process</li>
</ul>
<div class="gblog-post__anchorwrap"><h2 id="4-troubleshooting">4. Troubleshooting<a data-clipboard-text="https://eramons.github.io/techblog/post/asuschromebook_debian/#4-troubleshooting" class="gblog-post__anchor gblog-post__anchor--right clip" aria-label="Anchor 4. Troubleshooting" href="#4-troubleshooting"><svg class="icon link"><use xlink:href="#link"></use></svg></a></h2></div>
<p><strong>Goal: modify the kernel configuration as needed in order to have all hardware working. Install missing firmware.</strong></p>
<p>After a first test run - compiling and flashing the kernel with the default configuration - I identified several flaws:</p>
<ul>
<li>The wireless was not working</li>
<li>The touchscreen was not working</li>
<li>The touchpad was not working</li>
<li>The sound was not working</li>
</ul>
<div class="gblog-post__anchorwrap"><h3 id="wireless">Wireless<a data-clipboard-text="https://eramons.github.io/techblog/post/asuschromebook_debian/#wireless" class="gblog-post__anchor gblog-post__anchor--right clip" aria-label="Anchor Wireless" href="#wireless"><svg class="icon link"><use xlink:href="#link"></use></svg></a></h3></div>
<p>A look to dmesg revealed that the problem was just that the firmware files were missing.</p>
<p>Comparing with the running ChromeOS system on the same chromebook, I found out which firmware files were missing and which debian package will provide them:</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">apt-get install firmware-libertas
</code></pre></div><p><em>Notes:</em></p>
<ul>
<li><em>In order to install this firmware the contrib non-free sources must be included in /etc/apt/sources.list</em></li>
<li><em>Before getting the wi-fi to work, I used an ethernet cable and an usb-to-ethernet adapter</em></li>
</ul>
<p>After installing the firmware package wireless networking worked perfectly.</p>
<div class="gblog-post__anchorwrap"><h3 id="touchscreen--touchpad">Touchscreen &amp; Touchpad<a data-clipboard-text="https://eramons.github.io/techblog/post/asuschromebook_debian/#touchscreen--touchpad" class="gblog-post__anchor gblog-post__anchor--right clip" aria-label="Anchor Touchscreen &amp; Touchpad" href="#touchscreen--touchpad"><svg class="icon link"><use xlink:href="#link"></use></svg></a></h3></div>
<p>In order for the touchscreen and the touchpad to work, we need to manually add the missing kernel modules to the kernel configuration and re-compile.</p>
<p>Edit .config to include the following devices as kernel modules:</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash"><span class="nv">CONFIG_MOUSE_ELAN_I2C</span><span class="o">=</span>m
<span class="nv">CONFIG_MOUSE_ELAN_I2C_I2C</span><span class="o">=</span>m
<span class="nv">CONFIG_TOUCHSCREEN_ELAN</span><span class="o">=</span>m
</code></pre></div><p>Re-build the kernel with make, make a new version with mkimage and generate a chromebook bootable image with vbutil_kernel, same as before.</p>
<p>After this, we see the elan touchpad in /proc/bus/input/devices. The touchpad is working.</p>
<div class="gblog-post__anchorwrap"><h3 id="sound">Sound<a data-clipboard-text="https://eramons.github.io/techblog/post/asuschromebook_debian/#sound" class="gblog-post__anchor gblog-post__anchor--right clip" aria-label="Anchor Sound" href="#sound"><svg class="icon link"><use xlink:href="#link"></use></svg></a></h3></div>
<p>The sound wasn&rsquo;t working, although the corresponding modules seemed to be in place after comparing with a running ChromeOS system on the same device.</p>
<p>In addition, the sound settings in gnome only showed a &ldquo;dummy output&rdquo; as sound device. Apparently Debian does not include users in the audio group by default, so adding the user to the group improved the situation:</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">adduser eramon audio 
</code></pre></div><p>Although the sound wasn&rsquo;t still working, I was able to see two proper output devices in the sound settings in gnome.</p>
<p><em>At the time of this writing, the sound is still not working.</em></p>
<div class="gblog-post__anchorwrap"><h3 id="further-issues">Further issues<a data-clipboard-text="https://eramons.github.io/techblog/post/asuschromebook_debian/#further-issues" class="gblog-post__anchor gblog-post__anchor--right clip" aria-label="Anchor Further issues" href="#further-issues"><svg class="icon link"><use xlink:href="#link"></use></svg></a></h3></div>
<p>There is some other issues I did not go into:</p>
<ul>
<li>The system seems to recover well from suspend when it suspends in its own (after no pressing any key for a while). However, if closing the lid manually, the system is not able to recover.</li>
<li>The sound, brightness and other such keys (the top row on the Asus Chromebook keyboard) does not work as intended. Maybe just a configuration issue.</li>
</ul>
<div class="gblog-post__anchorwrap"><h2 id="5-kernel-and-rootfs-on-the-chromebook-disk">5. Kernel and rootfs on the chromebook disk<a data-clipboard-text="https://eramons.github.io/techblog/post/asuschromebook_debian/#5-kernel-and-rootfs-on-the-chromebook-disk" class="gblog-post__anchor gblog-post__anchor--right clip" aria-label="Anchor 5. Kernel and rootfs on the chromebook disk" href="#5-kernel-and-rootfs-on-the-chromebook-disk"><svg class="icon link"><use xlink:href="#link"></use></svg></a></h2></div>
<p><strong>Goal: Instead of booting from the sdcard, boot from the chromebook internal ssd</strong></p>
<p>Since we&rsquo;ll need several tries in order for the custom built kernel to boot, it&rsquo;s good to be able to boot both from the sdcard and from the internal drive. With Ctrl-D we&rsquo;ll be able to boot the experimental kernel we are building and with Ctrl-U we&rsquo;ll always be able to boot the already working mainline kernel on the sdcard first partition.</p>
<p>Tasks:</p>
<ul>
<li>Use gparted to resize the stateful partition</li>
<li>Create a new KERN-D and ROOT-D partitions and change the boot priorities</li>
<li>Flash the kernel to the KERN-D partition</li>
<li>Install a base debian system on ROOT-D using debootstrap</li>
</ul>
<p>Consequence: ChromeOS won&rsquo;t boot anymore. The reason is that resizing a partition changes the boot priority of the KERN partitions on the same disk as the resized partition.</p>
<p>If you plan to restore ChromeOS at some point, run:</p>
<pre><code> cgpt show /dev/mmcblk1
</code></pre><p>Save the output. In order to have ChromeOS to boot again, the values of this fields must be set as they were originally (using cgpt).
For example, the following command will restore the settings of KERN-A:</p>
<pre><code>sudo cgpt add -i 2 -S 1 -T 0 -P 2 /dev/mmcblk1
</code></pre><p>Note that after doing this, it won&rsquo;t be possible to boot debian anymore with Ctrl-D. Unfortunately coreboot/depthcharge only allow to boot one kernel (with Ctrl-D).</p>
<p>Original settings (output of cgpt show):</p>
<ul>
<li>KERN-A: priority=2 tries=0 successful=1</li>
<li>KERN-B: priority=1 tries=0 successful=1</li>
<li>KERN-C: priority=0 tries=15 successful=0</li>
</ul>
<p>So I resized the so called &ldquo;stateful partition&rdquo; from 10.53 GB to 5.00 GB:</p>
<pre><code>     8671232    10485760       1  Label: &quot;STATE&quot;
                                  Type: Linux data
                                  UUID: 1F4D5818-8E6B-0746-B1F9-E2E206777C85
</code></pre><p>I created two new partitions:</p>
<ul>
<li>For my debian kernel: KERN-D with size 100 MB</li>
<li>For my debian rootfs: ROOT-D with size 9.45 GB (e.g. all unallocated space after resize STATE and creating KERN-D)</li>
</ul>
<pre><code>    30539776      204800      13  Label: &quot;KERN-D&quot;
                                  Type: ChromeOS kernel
                                  UUID: 9CAA153C-8A88-0A4D-B750-FA2F52FB3A2E
                                  Attr: priority=10 tries=5 successful=1 
    10719232    19820544      14  Label: &quot;ROOT-D&quot;
                                  Type: 0FC63DAF-8483-4772-8E79-3D69D8477DE4
                                  UUID: C5E4E377-6D8F-4747-AA1F-6A8EEDDF031A
                                  UUID: C5E4E377-6D8F-4747-AA1F-6A8EEDDF031A
</code></pre><p>Set the priority, tries and succesful flag for the KERN-D partition:</p>
<pre><code>sudo cgpt add -i 1 -S 1 -T 0 -P 2 /dev/mmcblk0
</code></pre><p>Use debootstrap to create a debian rootfs on the new ROOT-D:</p>
<pre><code>sudo mount /dev/mmcblk1p14 dev/mnt
sudo debootstrap sid dev/mnt
sudo chroot dev/mnt
</code></pre><p>After chroot-ing to the new filesystem, I set the hostname, the root password, created an user and installed some useful packages:</p>
<pre><code>passwd
adduser eramon
cat &quot;chupito&quot; &gt; /etc/hostname
apt-get install locales wicd-curses sudo
dpkg-reconfigure locales
visudo
exit
sudo sync
</code></pre><p>To test the new setup is working, I flashed the working mainline kernel to KERN-D. For that, I modified the cmdline in order to use ROOT-D as the rootfs.</p>
<pre><code>cat &quot;console=ttyS2,115200n8 earlyprintk=ttyS2,115200n8 console=tty0 init=/sbin/init root=PARTUUID=c5e4e377-6d8f-4747-aa1f-6a8eeddf031a rootwait rw noinitrd loglevel=4&quot; &gt; cmdline
</code></pre><p><em>NOTE: the PARTUUID of the rootfs partition is hardcoded - it shouldn&rsquo;t but I did not know how to do otherwise</em></p>
<p>To find out the PARTUUID of ROOT-D:</p>
<pre><code>ls -l /dev/disk/by-partuuid/
</code></pre><p>Run vbutil as before using this modified cmdline:</p>
<pre><code>vbutil_kernel 
	--pack vmlinux.kpart 
	--version 1 
	--vmlinuz vmlinux.uimg 
	--arch aarch64 
	--keyblock /usr/share/vboot/devkeys/kernel.keyblock 
	--signprivate /usr/share/vboot/devkeys/kernel_data_key.vbprivk 
	--config cmdline 
	--bootloader bootloader.bin
</code></pre><p>Flash the modified kernel image to the KERN-D partition and reboot:</p>
<pre><code>sudo dd if=vmlinux.kpart of=/dev/mmcblk1p13
sudo sync
sudo reboot
</code></pre><p>After doing this, I was able to boot my custom mainline kernel with Ctrl-D. Once logged in over serial, we can install the X system and other necessary packages:</p>
<pre><code>apt-get install xserver-xorg gnome firmware-libertas
</code></pre><p><em>NOTE I: same as before and before getting the wi-fi to work, I had to use a network cable.</em></p>
<p><em>NOTE II: the chromebook has only a little drive (16 GB). For a productive setup, I ended up moving my /home partition to the sdcard - letting only the base system / on the ROOT-D partition.</em></p>
<div class="gblog-post__anchorwrap"><h2 id="6-debian-kernel">6. Debian Kernel<a data-clipboard-text="https://eramons.github.io/techblog/post/asuschromebook_debian/#6-debian-kernel" class="gblog-post__anchor gblog-post__anchor--right clip" aria-label="Anchor 6. Debian Kernel" href="#6-debian-kernel"><svg class="icon link"><use xlink:href="#link"></use></svg></a></h2></div>
<p><strong>Goal: replace the mainline linux kernel through the latest debian kernel.</strong></p>
<p>Tasks:</p>
<ul>
<li>Get the latest kernel source</li>
<li>Modify the kernel in order to include the modules for the touchpad and touchscreen to work</li>
<li>Build the debian package and install it</li>
<li>Modify the FDT image in order to include an initramfs since the debian kernel can&rsquo;t boot without it</li>
<li>Build the kernel image</li>
</ul>
<p>Instructions for re-building a debian kernel package (see &ldquo;Building a custom kernel from Debian kernel source&rdquo;):</p>
<p><a href="https://kernel-team.pages.debian.net/kernel-handbook/ch-common-tasks.html#s-common-official">Rebuilding official Debian kernel packages</a></p>
<p>Get the kernel source code:</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">apt-get install linux-source-4.19
tar xaf /usr/src/linux-source-4.19.16.tar.xz
</code></pre></div><p>Install following packages:</p>
<pre><code>apt-get install build-essential, fakeroot, build-dep, devscripts
</code></pre><p>Run the following command in order to generate the default configuration:</p>
<pre><code>make defconfig
</code></pre><p>Edit .config in order to include the necessary kernel modules we found out in the &ldquo;Troubleshooting&rdquo; section:</p>
<pre><code>vi .config

CONFIG_MOUSE_PS2_ELANTECH=m
CONFIG_MOUSE_ELAN_I2C=m
CONFIG_TOUCHSCREEN_ELAN=m
</code></pre><p><em>TODO: In order for the device to be supported in the future, submit a bug to the debian kernel team in order to suggest including the missing modules.</em></p>
<p>Build the kernel package:</p>
<pre><code>make deb-pkg
</code></pre><p>Install following file - generated by a succesfull build:</p>
<pre><code>dpkg -i linux-image-4.19.16-1_arm64.deb
</code></pre><p>This will install -among others- the following files:</p>
<pre><code>/boot/initrd-img-4.19.16
/boot/dtbs/rockchip/rk3399-gru-bob.dtb
</code></pre><p>Chromebooks don&rsquo;t use a ramdisk for booting. For the mainline kernel we used before, we didn&rsquo;t use one either. However in order for Debian to boot, a initramfs (or ramdisk) is mandatory.</p>
<p>Get the files we need for making the image and which will be referenced in kernel.its:</p>
<ul>
<li>kernel: get the Image file from the compiled source: arch/arm64/boot/Image</li>
<li>ramdisk: /boot/initrd-img-4.19.16 installed by dpkg before</li>
<li>dtb: arch/arm64/boot/dts/rockchip/rk3399-gru-bob.dtb (also available under /boot/dtbs/rockchip/rk3399-gru-bob.dtb installed by dpkg before)</li>
</ul>
<p>Edit the kernel.its file we used before in order to include a ramdisk:
<a href="https://github.com/eramons/chromebook/blob/master/debkernel.its">https://github.com/eramons/chromebook/blob/master/debkernel.its</a></p>
<pre><code>/dts-v1/;

/ {
    description = &quot;Debian kernel image with one blob for the Asus C101 (Bob) and initramfs&quot;;

    images {
        kernel@1{
            description = &quot;kernel&quot;;
            data = /incbin/(&quot;linux/debian/arch/arm64/boot/Image&quot;);
            type = &quot;kernel_noload&quot;;
            arch = &quot;arm64&quot;;
            os = &quot;linux&quot;;
            compression = &quot;none&quot;;
            load = &lt;0&gt;;
            entry = &lt;0&gt;;
        };
        fdt@1{
            description = &quot;rk3399-gru-bob.dtb&quot;;
            data = /incbin/(&quot;linux/debian/arch/arm64/boot/dts/rockchip/rk3399-gru-bob.dtb&quot;);
            type = &quot;flat_dt&quot;;
            arch = &quot;arm64&quot;;
            compression = &quot;none&quot;;
            hash@1{
                algo = &quot;sha1&quot;;
            };
        };
	ramdisk@1 {
           description = &quot;initramfs&quot;;
           data = /incbin/(&quot;/boot/initrd.img-4.19.16&quot;);
           type = &quot;ramdisk&quot;;
           arch = &quot;arm64&quot;;
           compression = &quot;none&quot;;
           hash@1 {
                algo = &quot;sha1&quot;;
           };
	};
    };
    configurations {
        default = &quot;conf@1&quot;;
        conf@1{
            kernel = &quot;kernel@1&quot;;
            fdt = &quot;fdt@1&quot;;
            ramdisk = &quot;ramdisk@1&quot;;
        };
    };
};
</code></pre><p>Make image:</p>
<pre><code>mkimage -D &quot;-I dts -O dtb -p 2048&quot; -f debkernel.its vmlinux.uimg
</code></pre><p>Find out the partition UID of the root partition:</p>
<pre><code>ls -l /dev/disk/by-partuuid/
</code></pre><p>Prepare the cmdline:</p>
<pre><code>echo &quot;console=ttyS2,115200n8 earlyprintk=ttyS2,115200n8 console=tty0 init=/sbin/init root=PARTUUID=c5e4e377-6d8f-4747-aa1f-6a8eeddf031a rootwait rw loglevel=4&quot; &gt; cmdline_debian
</code></pre><p>Generate an empty bootloader.bin file:</p>
<pre><code>dd if=/dev/zero of=bootloader.bin bs=512 count=1
</code></pre><p>Run vbutil in order to generate a boot image for the chromebook:</p>
<pre><code>vbutil_kernel 
	--pack vmlinux.kpart 
	--version 1 
	--vmlinuz vmlinux.uimg 
	--arch aarch64 
	--keyblock /usr/share/vboot/devkeys/kernel.keyblock 
	--signprivate /usr/share/vboot/devkeys/kernel_data_key.vbprivk 
	--config cmdline_debian 
	--bootloader bootloader.bin
</code></pre><p>Flash the new generated image to the ROOT-D partition on the chromebook, sync and reboot:</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">sudo dd <span class="k">if</span><span class="o">=</span>vmlinuz.kpart <span class="nv">of</span><span class="o">=</span>/dev/mmcblk1p14
sudo sync
sudo reboot
</code></pre></div><p>Done :) Debian on the chromebook: a debian rootfs and a customized, self-built debian kernel.</p>
<p><em>And now? Next steps:</em></p>
<ul>
<li>Coreboot/Depthcharge: build an u-boot payload for the Asus C101. Extend flash-kernel to support the board.</li>
<li>Alternatively, build a second depthcharge payload loaded through the legacy mechanism provided by the chromebooks (Ctrl-L) which loads the KERN-D kernel.</li>
</ul>


        </section>
    </article>

        </main>

        <footer class="gblog-footer">
    <div class="container">
        <div class="flex flex-wrap align-center">
            
            
            <span class="gblog-footer__item">
                <svg class="icon email"><use xlink:href="#email"></use></svg>
                <a href='/techblog/contact/' class="gblog-footer__link">Contact</a>
            </span>
            
            
            
            
            <span class="gblog-footer__item">
                Content licensed under <a href="https://creativecommons.org/licenses/by-sa/4.0/" class="gblog-footer__link no-wrap">CC BY-SA 4.0</a>
            </span>
            
        </div>
        <div class="flex flex-wrap align-center">
            <span class="gblog-footer__item">
                Built with <a href="https://gohugo.io/" class="gblog-footer__link">Hugo</a> and
                <svg class="icon heart"><use xlink:href="#heart"></use></svg>
            </span>
        </div>
        
    </div>
</footer>

    </div>

    
<script defer src="/techblog/js/clipboard-f06c52bfdd.min.js"></script>
<script>
    document.addEventListener("DOMContentLoaded", function(event) {
        var clipboard = new ClipboardJS('.clip');
    });
</script>


</body>
</html>
